<!DOCTYPE html>

<html lang="en">

<head>
<title>Mon generateur de QRCode (STE 2022)</title>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAbwAAAG8B8aLcQwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGVSURBVDiNddM/a1VBEAXw3wYVBEnUwuQTSLBSEMFn4bOzCBoFIZWWgljEfIIUlkIsRJ6dpFKEkMI6/sFGEV7snmARUDEKQooYLQJjsXPNhfccGO7M7Lmzs2fPQozw2YiARbzMeHYUdp9qd7Ce8XMopdzHF8zbs1+YyfgklsYyWccq9mO3BTiEnVJKL2u7iVltNmwmgGvot/I1bOMcDrfq/cT+s0jgVnrkeY/i3ggOGtx2w8EVw/YWKziPV63aMDa7L+M2zmCQfgnT+R1ERINdyPXliFDQS0IOYgKb2XsK73PUFxFRSikLOIKvGMeJMdzMjp9xDD8joocuTuMHnpZS5jCJgj/J0Q25YyfHu4CNjFdwF1OZb6Kj6mKj8ZLsDpEYEd9KKYvoRkR3BIYcJ1SFNQKaUNmewwd8xMNcu5pTdNQrXmmENKMqrI9PLRIHeGNPzpfxHQ9wAJONlOEZTrXyx6pgbmE6Ip7kz4Hj6hU/koV5lfWuem3t17iF17k2nrUdqYPmCEv/I0nVyEX8xtmsvYuI6/AX2+Wh45jNpXMAAAAASUVORK5CYII=">
<style>
	#qrcode {
	  width:160px;
	  height:160px;
	  margin-top:15px;
	}


	.split {
	  height: 100%;
	  width: 50%;
	  position: fixed;
	  z-index: 1;
	  top: 0;
	  overflow-x: hidden;
	  padding-top: 20px;
	}

	.left {
	  left: 0;
	}

	.right {
		right: 0;
		background-color: LightGray;
	}

</style>

<script src="jquery.min.js"></script>
<script src="qrcode.min.js"></script>
<script src="jsQR.js"></script>
</head>

<body>


<div class="split left">
	<!-- Text to QRCode -->
	<h1>Text &rarr; QRCode</h1>
	<p>
		Code : <a href="https://davidshimjs.github.io/qrcodejs/">https://davidshimjs.github.io/qrcodejs/</a>
	</p>
		
	<input id="text" type="text" value="" style="width:90%"><br>
	<div id="qrcode"></div>
</div>


<div class="split right">
	<!-- QRCode to text -->
	<h1>QRCode &rarr; text</h1>
	<p>
		Code : <a href="https://github.com/cozmo/jsQR">https://github.com/cozmo/jsQR</a>
	</p>
	
	<input id="outputData" type="text" value="No QR code detected." style="width:90%">
	<button onclick="copy2clipboard()">Copy text</button>
	<br>
	
	<div id="loadingMessage">Click <a href="#" onClick="requestCamera()">here</a> to grant camera access</div>
	<canvas id="canvas" hidden></canvas>

</div>



<script>
/////////////////
// Text to QRCode
/////////////////
var qrcode = new QRCode("qrcode");

function makeCode () {    
  var elText = document.getElementById("text");
  
  if (!elText.value) {
    alert("Input a text");
    elText.focus();
    return;
  }
  
  qrcode.makeCode(elText.value);
}

function processArgs() {
    var parameter = location.search;

	var temp = parameter.split("=");
	var text = unescape(temp[1]);
	
	document.getElementById("text").value = text;
}

processArgs();
makeCode();


// select all text, so that user can type directly
document.getElementById("text").select();

$("#text").
  on("blur", function () {
    makeCode();
  }).
  on("keydown", function (e) {
    if (e.keyCode == 13) {
      makeCode();
    }
  });




/////////////////
// QRCode to text
/////////////////
var video = document.createElement("video");
var canvasElement = document.getElementById("canvas");
var canvas = canvasElement.getContext("2d");
var loadingMessage = document.getElementById("loadingMessage");
var outputData = document.getElementById("outputData");

function drawLine(begin, end, color) {
  canvas.beginPath();
  canvas.moveTo(begin.x, begin.y);
  canvas.lineTo(end.x, end.y);
  canvas.lineWidth = 4;
  canvas.strokeStyle = color;
  canvas.stroke();
}

// Use facingMode: environment to attemt to get the front camera on phones
function requestCamera() {
	navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function(stream) {
	  video.srcObject = stream;
	  video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
	  video.play();
	  requestAnimationFrame(tick);
	});
}

function tick() {
  loadingMessage.innerText = "Loading video..."
  if (video.readyState === video.HAVE_ENOUGH_DATA) {
	loadingMessage.hidden = true;
	canvasElement.hidden = false;

	canvasElement.height = video.videoHeight;
	canvasElement.width = video.videoWidth;
	canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
	var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
	var code = jsQR(imageData.data, imageData.width, imageData.height, {
	  inversionAttempts: "dontInvert",
	});
	if (code) {
	  drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF3B58");
	  drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF3B58");
	  drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF3B58");
	  drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF3B58");
	  outputData.value = code.data;
	}
  }
  requestAnimationFrame(tick);
}


function copy2clipboard() {
  // Select the text field
  outputData.select();
  outputData.setSelectionRange(0, 99999); // For mobile devices

   // Copy the text inside the text field
  navigator.clipboard.writeText(outputData.value);

}

</script>


</body>

</html>